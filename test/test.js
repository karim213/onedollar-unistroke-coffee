var assert = require('chai').assert;
var OneDollar = require('../lib/onedollar').OneDollar;

describe('algorithm', function() {

  describe('start(), update(), end()', function() {
    it('should match 100% by using the runtime functions', function() {
      var one = new OneDollar();
      one.add('fff', [[137,139], [135,141], [133,144], [132,146], [130,149], [128,151], [126,155], [123,160], [120,166], [116,171], [112,177], [107,183], [102,188], [100,191], [95,195], [90,199], [86,203], [82,206], [80,209], [75,213], [73,213], [70,216], [67,219], [64,221], [61,223], [60,225], [62,226], [65,225], [67,226], [74,226], [77,227], [85,229], [91,230], [99,231], [108,232], [116,233], [125,233], [134,234], [145,233], [153,232], [160,233], [170,234], [177,235], [179,236], [186,237], [193,238], [198,239], [200,237], [202,239], [204,238], [206,234], [205,230], [202,222], [197,216], [192,207], [186,198], [179,189], [174,183], [170,178], [164,171], [161,168], [154,160], [148,155], [143,150], [138,148], [136,148]]);
      one.start([137,139]);
      one.update([135,141]); one.update([133,144]); one.update([132,146]); one.update([130,149]); one.update([128,151]); one.update([126,155]); one.update([123,160]); one.update([120,166]); one.update([116,171]); one.update([112,177]); one.update([107,183]); one.update([102,188]); one.update([100,191]); one.update([95,195]); one.update([90,199]); one.update([86,203]); one.update([82,206]); one.update([80,209]); one.update([75,213]); one.update([73,213]); one.update([70,216]); one.update([67,219]); one.update([64,221]); one.update([61,223]); one.update([60,225]); one.update([62,226]); one.update([65,225]); one.update([67,226]); one.update([74,226]); one.update([77,227]); one.update([85,229]); one.update([91,230]); one.update([99,231]); one.update([108,232]); one.update([116,233]); one.update([125,233]); one.update([134,234]); one.update([145,233]); one.update([153,232]); one.update([160,233]); one.update([170,234]); one.update([177,235]); one.update([179,236]); one.update([186,237]); one.update([193,238]); one.update([198,239]); one.update([200,237]); one.update([202,239]); one.update([204,238]); one.update([206,234]); one.update([205,230]); one.update([202,222]); one.update([197,216]); one.update([192,207]); one.update([186,198]); one.update([179,189]); one.update([174,183]); one.update([170,178]); one.update([164,171]); one.update([161,168]); one.update([154,160]); one.update([148,155]); one.update([143,150]); one.update([138,148]);
      var result = one.end([136,148]);
      assert.closeTo(result.ranking[0].score, 100.0, 1);
      delete one;
    });

    it('should match 100% by using the concatenated runtime functions', function() {
      var one = new OneDollar();
      one.add('ddd', [[137,139], [135,141], [133,144], [132,146], [130,149], [128,151], [126,155], [123,160], [120,166], [116,171], [112,177], [107,183], [102,188], [100,191], [95,195], [90,199], [86,203], [82,206], [80,209], [75,213], [73,213], [70,216], [67,219], [64,221], [61,223], [60,225], [62,226], [65,225], [67,226], [74,226], [77,227], [85,229], [91,230], [99,231], [108,232], [116,233], [125,233], [134,234], [145,233], [153,232], [160,233], [170,234], [177,235], [179,236], [186,237], [193,238], [198,239], [200,237], [202,239], [204,238], [206,234], [205,230], [202,222], [197,216], [192,207], [186,198], [179,189], [174,183], [170,178], [164,171], [161,168], [154,160], [148,155], [143,150], [138,148], [136,148]]);
      var result = one.start([137,139]).update([135,141]).update([133,144]).update([132,146]).update([130,149]).update([128,151]).update([126,155]).update([123,160]).update([120,166]).update([116,171]).update([112,177]).update([107,183]).update([102,188]).update([100,191]).update([95,195]).update([90,199]).update([86,203]).update([82,206]).update([80,209]).update([75,213]).update([73,213]).update([70,216]).update([67,219]).update([64,221]).update([61,223]).update([60,225]).update([62,226]).update([65,225]).update([67,226]).update([74,226]).update([77,227]).update([85,229]).update([91,230]).update([99,231]).update([108,232]).update([116,233]).update([125,233]).update([134,234]).update([145,233]).update([153,232]).update([160,233]).update([170,234]).update([177,235]).update([179,236]).update([186,237]).update([193,238]).update([198,239]).update([200,237]).update([202,239]).update([204,238]).update([206,234]).update([205,230]).update([202,222]).update([197,216]).update([192,207]).update([186,198]).update([179,189]).update([174,183]).update([170,178]).update([164,171]).update([161,168]).update([154,160]).update([148,155]).update([143,150]).update([138,148]).end([136,148]);
      assert.closeTo(result.ranking[0].score, 100.0, 1);
      delete one;
    });
  });

  describe('add(), remove()', function() {
    it('the ranking size should match the number of binded callbacks', function() {
      var one = new OneDollar();
      one.add('a', [[137,139], [135,141], [133,144], [132,146], [130,149], [128,151], [126,155], [123,160], [120,166], [116,171], [112,177], [107,183], [102,188], [100,191], [95,195], [90,199], [86,203], [82,206], [80,209], [75,213], [73,213], [70,216], [67,219], [64,221], [61,223], [60,225], [62,226], [65,225], [67,226], [74,226], [77,227], [85,229], [91,230], [99,231], [108,232], [116,233], [125,233], [134,234], [145,233], [153,232], [160,233], [170,234], [177,235], [179,236], [186,237], [193,238], [198,239], [200,237], [202,239], [204,238], [206,234], [205,230], [202,222], [197,216], [192,207], [186,198], [179,189], [174,183], [170,178], [164,171], [161,168], [154,160], [148,155], [143,150], [138,148], [136,148]]);
      one.add('b', [[621,225],[616,225],[608,225],[601,225],[594,227],[572,235],[562,241],[548,251],[532,270],[504,314],[495,340],[492,363],[492,385],[494,422],[505,447],[524,470],[550,492],[607,523],[649,531],[689,531],[751,523],[782,510],[807,495],[826,470],[851,420],[859,393],[860,366],[858,339],[852,311],[833,272],[815,248],[793,229],[768,214],[729,198],[704,191],[678,189],[655,188],[623,188],[614,188],[611,188],[611,188]]);
      one.on('a', function(result) {});
      var result = one.check([[621,225],[616,225],[608,225],[601,225],[594,227],[572,235],[562,241],[548,251],[532,270],[504,314],[495,340],[492,363],[492,385],[494,422],[505,447],[524,470],[550,492],[607,523],[649,531],[689,531],[751,523],[782,510],[807,495],[826,470],[851,420],[859,393],[860,366],[858,339],[852,311],[833,272],[815,248],[793,229],[768,214],[729,198],[704,191],[678,189],[655,188],[623,188],[614,188],[611,188],[611,188]]);
      assert.equal(1, result.ranking.length);
      delete one;
    });
  });

  describe('check()', function() {
    it('should match 100% by using the returned results', function() {
      var one = new OneDollar();
      one.add('nnn', [[137,139], [135,141], [133,144], [132,146], [130,149], [128,151], [126,155], [123,160], [120,166], [116,171], [112,177], [107,183], [102,188], [100,191], [95,195], [90,199], [86,203], [82,206], [80,209], [75,213], [73,213], [70,216], [67,219], [64,221], [61,223], [60,225], [62,226], [65,225], [67,226], [74,226], [77,227], [85,229], [91,230], [99,231], [108,232], [116,233], [125,233], [134,234], [145,233], [153,232], [160,233], [170,234], [177,235], [179,236], [186,237], [193,238], [198,239], [200,237], [202,239], [204,238], [206,234], [205,230], [202,222], [197,216], [192,207], [186,198], [179,189], [174,183], [170,178], [164,171], [161,168], [154,160], [148,155], [143,150], [138,148], [136,148]]);
      var result = one.check([[137,139], [135,141], [133,144], [132,146], [130,149], [128,151], [126,155], [123,160], [120,166], [116,171], [112,177], [107,183], [102,188], [100,191], [95,195], [90,199], [86,203], [82,206], [80,209], [75,213], [73,213], [70,216], [67,219], [64,221], [61,223], [60,225], [62,226], [65,225], [67,226], [74,226], [77,227], [85,229], [91,230], [99,231], [108,232], [116,233], [125,233], [134,234], [145,233], [153,232], [160,233], [170,234], [177,235], [179,236], [186,237], [193,238], [198,239], [200,237], [202,239], [204,238], [206,234], [205,230], [202,222], [197,216], [192,207], [186,198], [179,189], [174,183], [170,178], [164,171], [161,168], [154,160], [148,155], [143,150], [138,148], [136,148]]);
      assert.closeTo(result.ranking[0].score, 100.0, 1);
      delete one;
    });

    it('should match 100% by using the defined callback function', function() {
      var one = new OneDollar();
      one.add('mmm', [[137,139], [135,141], [133,144], [132,146], [130,149], [128,151], [126,155], [123,160], [120,166], [116,171], [112,177], [107,183], [102,188], [100,191], [95,195], [90,199], [86,203], [82,206], [80,209], [75,213], [73,213], [70,216], [67,219], [64,221], [61,223], [60,225], [62,226], [65,225], [67,226], [74,226], [77,227], [85,229], [91,230], [99,231], [108,232], [116,233], [125,233], [134,234], [145,233], [153,232], [160,233], [170,234], [177,235], [179,236], [186,237], [193,238], [198,239], [200,237], [202,239], [204,238], [206,234], [205,230], [202,222], [197,216], [192,207], [186,198], [179,189], [174,183], [170,178], [164,171], [161,168], [154,160], [148,155], [143,150], [138,148], [136,148]]);
      one.on('mmm', function(result) {
        assert.closeTo(result.ranking[0].score, 100.0, 1);
      });
      delete one;
    });
  });

});
